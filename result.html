<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Result – Pulse Canvas</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a class="brand" href="index.html">
        <span class="title">Pulse Canvas</span>
        <span class="tag">Two-person empathy study</span>
      </a>

      <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="gallery.html">Gallery</a>
        <a href="instructions.html" class="primary">Start</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <h1>Your conversation buddy’s screen</h1>
    <p class="small" id="meta"></p>

    <!-- Call controls -->
    <div class="card" style="margin: 14px 0;">
      <div class="row" style="gap:10px; flex-wrap:wrap;">
        <button id="btnStartAudio" class="btn">Enable Audio / Start Call</button>
        <button id="btnMute" class="btn secondary" disabled>Mute Mic</button>
        <button id="btnHangup" class="btn danger" disabled>Hang Up</button>
      </div>
      <p class="small" id="callStatus" style="margin-top:10px;">Status: idle</p>
      <p class="small" style="opacity:0.85; margin-top:6px;">
        Tip: use closed-back headphones to reduce voice bleed.
      </p>
    </div>

    <!-- Remote audio plays here -->
    <audio id="remoteAudio" autoplay playsinline></audio>

    <div class="screen">
      <iframe
        id="artFrame"
        title="Conversation buddy artwork"
        allow="autoplay; microphone; camera"
      ></iframe>
    </div>

    <div class="row" style="margin-top:18px;">
      <a href="gallery.html" class="btn secondary">Gallery</a>
      <a href="index.html" class="btn secondary">Home</a>
    </div>
  </main>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Your Firebase init -->
  <script src="js/firebase.js"></script>

  <!-- WebRTC call + page logic -->
  <script src="js/result-call.js"></script>

  <script>
    // Keep your existing embed behavior
    const params = new URLSearchParams(window.location.search);
    const session = params.get("session") || "";

    const meta = document.getElementById("meta");
    if (session) meta.textContent = `Session: ${session}`;
    else meta.textContent = "No session code found. Open this page with ?session=YOURCODE";

    // TEMPORARY shared p5 sketch for both participants
    document.getElementById("artFrame").src =
      "https://editor.p5js.org/Hana_Namdar/full/D814zdJEF";

    // Pass session into the call script
    window.__PULSE_SESSION__ = session;
  </script>

</body>
</html>