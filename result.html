<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Result – Pulse Canvas</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <header class="site-header">
    <div class="header-inner">
      <a class="brand" href="index.html">
        <span class="title">Pulse Canvas</span>
      </a>

      <nav>
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a href="gallery.html">Gallery</a>
        <a href="instructions.html" class="primary">Start</a>
      </nav>
    </div>
  </header>

  <main>
    <h1>Your conversation buddy’s screen</h1>
    <p class="small" id="meta"></p>

    <!-- Shared Topic Display -->
    <div class="card" style="margin: 14px 0;">
      <h2 style="margin:0 0 6px 0;">Your Topic</h2>
      <div id="topicText" style="font-size:1.05rem; line-height:1.6; color:rgba(255,255,255,0.92);">
        Loading topic…
      </div>
      <p id="topicStatus" class="small" style="margin-top:10px;">&nbsp;</p>
      <p class="small" style="margin-top:8px; opacity:0.85;">
        If no topic is shown, go back and select one before starting.
      </p>
      <div class="row" style="margin-top:12px;">
        <a href="topics.html" class="btn secondary">Back to Topics</a>
      </div>
    </div>

    <!-- Call controls -->
    <div class="card" style="margin: 14px 0;">
      <div class="row" style="gap:10px; flex-wrap:wrap;">
        <button id="btnStartAudio" class="btn" disabled>Enable Audio / Start Call</button>
        <button id="btnMute" class="btn secondary" disabled>Mute Mic</button>
        <button id="btnHangup" class="btn danger" disabled>Hang Up</button>
      </div>
      <p class="small" id="callStatus" style="margin-top:10px;">Status: idle</p>
      <p class="small" style="opacity:0.85; margin-top:6px;">
        Tip: use closed-back headphones to reduce voice bleed.
      </p>
    </div>

    <audio id="remoteAudio" autoplay playsinline></audio>

    <div class="screen">
      <iframe
        id="artFrame"
        title="Conversation buddy artwork"
        allow="autoplay; microphone; camera"
      ></iframe>
    </div>

    <div class="row" style="margin-top:18px;">
      <a href="gallery.html" class="btn secondary">Gallery</a>
      <a href="index.html" class="btn secondary">Home</a>
    </div>
  </main>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script src="js/firebase.js"></script>

  <!-- Set session BEFORE scripts -->
  <script>
    const params = new URLSearchParams(window.location.search);
    const session = params.get("session") || "";

    const meta = document.getElementById("meta");
    meta.textContent = session
      ? `Session: ${session}`
      : "No session code found. Open this page through Connect.";

    window.__PULSE_SESSION__ = session;

    // TEMPORARY shared p5 sketch for both participants
    const frame = document.getElementById("artFrame");
    if (frame) frame.src = "https://editor.p5js.org/Hana_Namdar/full/D814zdJEF";
  </script>

  <script src="js/result-call.js"></script>
  <script src="js/topic-sync.js"></script>

</body>
</html>